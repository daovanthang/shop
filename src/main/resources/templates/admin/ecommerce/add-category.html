<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/layout}">
<head>
    <title>Add product</title>
</head>
<body>

<div layout:fragment="content">
      <!-- Content -->
      <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
          <div class="row align-items-center">
            <div class="col-sm mb-2 mb-sm-0">
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb breadcrumb-no-gutter">
                  <li class="breadcrumb-item"><a class="breadcrumb-link" href="ecommerce-products.html">Products</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Add product</li>
                </ol>
              </nav>

              <h1 class="page-header-title">Thêm nghành hàng</h1>
            </div>
          </div>
          <!-- End Row -->
        </div>
        <!-- End Page Header -->
		<form th:action="@{/admin/product/save}" method="POST" th:object="${categoryDto}" id ="identifier">
        	<textarea name="text" th:field="*{description}" style="display:none" id="hiddenArea"></textarea>
        	<input id="status" th:field="*{status}" type="checkbox" name="status" style="display:none"/>
        <div class="row">
          <div class="col-lg-8">
            <!-- Card -->
            
            <div class="card mb-3 mb-lg-5">
              <!-- Header -->
              <div class="card-header">
                <h4 class="card-header-title">Thông tin nghành hàng</h4>
              </div>
              <!-- End Header -->

              <!-- Body -->
           
              <div class="card-body">
                <!-- Form Group -->
                <div class="form-group">
                  <label for="productNameLabel" class="input-label">Tên nghành hàng <i class="tio-help-outlined text-body ml-1" data-toggle="tooltip" data-placement="top" title="Products are the goods or services you sell."></i></label>

                  <input type="text" th:field="*{name}" class="form-control" name="productName"  id="productNameLabel" placeholder="Shirt, t-shirts, etc." aria-label="Shirt, t-shirts, etc.">
                </div>
                <!-- End Form Group -->

                <div class="row">
                  <div class="col-sm-6">
                    <!-- Form Group -->
                  <div class="form-group">
                    <label for="SKULabel" class="input-label">Vị Trí</label>

                    <input type="text" th:field="*{sortOrder}" class="form-control" name="SKU" id="SKULabel" placeholder="eg. 348121032" aria-label="eg. 348121032">
                  </div>
                  <!-- End Form Group -->
                  </div>
                </div>
                <!-- End Row -->
                
                <label class="input-label">Mô tả nghành hàng <span class="input-label-secondary">(Optional)</span></label>

                <!-- Quill -->
                <div class="quill-custom">
                  <div class="js-quill" style="min-height: 15rem;" data-hs-quill-options='{
                          "placeholder": "Type your description..."
                         }'>
                  </div>
                  
                </div>
                <!-- End Quill -->
              </div>
              <!-- Body -->
            </div>
            <!-- End Card -->
			<!-- media -->
			              <div class="card-body">
                <!-- Dropzone -->
                <div
                  id="attachFilesNewProjectLabel"
                  class="js-dropzone dropzone-custom custom-file-boxed"
                >
                <input id="imageUrl" name="imageUrl" type="text" th:field="*{imageUrl}" style="display:none"/>
                  <div class="dz-message custom-file-boxed-label">
                    <img
                      class="avatar avatar-xl avatar-4by3 mb-3"
                      src="\admin\assets\svg\illustrations\browse.svg"
                      alt="Image Description"
                    />
                    <h5 class="mb-1">KÃ©o má»™t hoáº·c nhiá»�u hÃ¬nh</h5>
                    <p class="mb-2">Hoáº·c</p>
                    <span class="btn btn-sm btn-primary">Browse files</span>
                  </div>
                </div>
                <!-- End Dropzone -->
              </div>
            <!-- Card -->
            <!-- End Card -->
          </div>

          <div class="col-lg-4">
            <!-- Card -->
            <div class="card mb-3 mb-lg-5">
              <!-- Header -->
              <div class="card-header">
                <h4 class="card-header-title">GiÃ¡ & Sá»‘ LÆ°á»£ng</h4>
              </div>
              <!-- End Header -->

              <!-- Body -->
              <div class="card-body">
                <!-- Form Group -->
                <div class="form-group">
                  <label for="priceNameLabel" class="input-label">GiÃ¡</label>
  
                  <div class="input-group">
                    <input type="text" class="form-control" name="priceName" id="priceNameLabel" placeholder="0.00" aria-label="0.00">
                  </div>
                </div>
                <div class="form-group">
                  <label for="quantyLabel" class="input-label">Sá»‘ LÆ°á»£ng</label>
  
                  <div class="input-group">
                    <input type="text"  class="form-control" name="priceName" id="priceNameLabel" placeholder="0.00" aria-label="0.00">
                  </div>
                </div>
                <!-- End Form Group -->

                <hr class="my-4">

               <!-- Checkbox Switch -->
				<label class="toggle-switch d-flex align-items-center mb-3" for="customSwitch1">
				  <input type="checkbox" class="toggle-switch-input" id="customSwitch1">
				  <span class="toggle-switch-label">
				    <span class="toggle-switch-indicator"></span>
				  </span>
				  <span class="toggle-switch-content">
				    <span class="d-block">KÃ­ch hoáº¡t</span>
				  </span>
				</label>
				<!-- End Checkbox Switch -->
              </div>
              <!-- Body -->
            </div>
            <!-- End Card -->

            <!-- Card -->
            <div class="card">
              <!-- Header -->
              <div class="card-header">
                <h4 class="card-header-title">Organization</h4>
              </div>
              <!-- End Header -->

              <!-- Body -->
              <div class="card-body">
                <!-- End Form Group -->

                <!-- Form Group -->
                <div class="form-group">
                  <label for="categoryLabel" class="input-label">Nghành hàng</label>

                  <!-- Select -->
                  <select class="js-select2-custom custom-select" size="1" style="opacity: 0;" id="categoryLabel" data-hs-select2-options='{
                            "minimumResultsForSearch": "Infinity",
                            "placeholder": "Select category"
                          }'>
                    <option label="empty"></option>
                    <option value="Clothing">Clothing</option>
                    <option value="Shoes">Shoes</option>
                    <option value="Electronics">Electronics</option>
                    <option value="Others">Others</option>
                  </select>
                  <!-- End Select -->
                </div>
                <!-- Form Group -->

                <label for="tagsLabel" class="input-label">Tags</label>

                <input type="text" class="js-tagify tagify-form-control form-control" name="tagsName" id="tagsLabel" placeholder="Enter tags here" aria-label="Enter tags here">
              </div>
              <!-- End Body -->
            </div>
            <!-- End Card -->
          </div>
       	
        </div>
        <!-- End Row -->
        <div class="position-fixed bottom-0 content-centered-x w-100 z-index-99 mb-3" style="max-width: 40rem;">
          <!-- Card -->
          <div class="card card-sm bg-dark border-dark mx-2">
            <div class="card-body">
              <div class="row justify-content-center justify-content-sm-between">
                <div class="col">
                  <button  type="button" class="btn btn-ghost-danger">Delete</button>
                </div>
                <div class="col-auto">
                  <button type="button" class="btn btn-ghost-light mr-2">Discard</button>
                  <button type="submit" class="btn btn-primary" id="submit-one">LÆ°u</button>
                </div>
              </div>
              <!-- End Row -->
            </div>
          </div>
          <!-- End Card -->
        </div>
      </form>
      </div>
      <!-- End Content -->

      <!-- Footer -->
      
        <div class="footer">
          <div class="row justify-content-between align-items-center">
            <div class="col">
              <p class="font-size-sm mb-0">&copy; Front. <span class="d-none d-sm-inline-block">2020 Htmlstream.</span></p>
            </div>
            <div class="col-auto">
              <div class="d-flex justify-content-end">
                <!-- List Dot -->
                <ul class="list-inline list-separator">
                  <li class="list-inline-item">
                    <a class="list-separator-link" href="#">FAQ</a>
                  </li>

                  <li class="list-inline-item">
                    <a class="list-separator-link" href="#">License</a>
                  </li>

                  <li class="list-inline-item">
                    <!-- Keyboard Shortcuts Toggle -->
                    <div class="hs-unfold">
                      <a class="js-hs-unfold-invoker btn btn-icon btn-ghost-secondary rounded-circle" href="javascript:;" data-hs-unfold-options='{
                              "target": "#keyboardShortcutsSidebar",
                              "type": "css-animation",
                              "animationIn": "fadeInRight",
                              "animationOut": "fadeOutRight",
                              "hasOverlay": true,
                              "smartPositionOff": true
                             }'>
                        <i class="tio-command-key"></i>
                      </a>
                    </div>
                    <!-- End Keyboard Shortcuts Toggle -->
                  </li>
                </ul>
                <!-- End List Dot -->
              </div>
            </div>
          </div>
        </div>
      

      
      <!-- End Footer -->
</div>
<th:block layout:fragment="optional" >
	    <script>
      $(document).on('ready', function () {
        // ONLY DEV
        // =======================================================
        
          if (window.localStorage.getItem('hs-builder-popover') === null) {
            $('#builderPopover').popover('show')
              .on('shown.bs.popover', function () {
                $('.popover').last().addClass('popover-dark')
              });

            $(document).on('click', '#closeBuilderPopover' , function() {
              window.localStorage.setItem('hs-builder-popover', true);
              $('#builderPopover').popover('dispose');
            });
          } else {
            $('#builderPopover').on('show.bs.popover', function () {
              return false
            });
          }
        
        // END ONLY DEV
        // =======================================================


        // BUILDER TOGGLE INVOKER
        // =======================================================
        $('.js-navbar-vertical-aside-toggle-invoker').click(function () {
          $('.js-navbar-vertical-aside-toggle-invoker i').tooltip('hide');
        });

        
          // INITIALIZATION OF MEGA MENU
          // =======================================================
          var megaMenu = new HSMegaMenu($('.js-mega-menu'), {
            desktop: {
              position: 'left'
            }
          }).init();
        

        
        // INITIALIZATION OF NAVBAR VERTICAL NAVIGATION
        // =======================================================
        var sidebar = $('.js-navbar-vertical-aside').hsSideNav();

        
        // INITIALIZATION OF TOOLTIP IN NAVBAR VERTICAL MENU
        // =======================================================
        $('.js-nav-tooltip-link').tooltip({ boundary: 'window' })

        $(".js-nav-tooltip-link").on("show.bs.tooltip", function(e) {
          if (!$("body").hasClass("navbar-vertical-aside-mini-mode")) {
            return false;
          }
        });

        
        // INITIALIZATION OF UNFOLD
        // =======================================================
        $('.js-hs-unfold-invoker').each(function () {
          var unfold = new HSUnfold($(this)).init();
        });

        
        // INITIALIZATION OF FORM SEARCH
        // =======================================================
        $('.js-form-search').each(function () {
          new HSFormSearch($(this)).init()
        });

        
        // INITIALIZATION OF SELECT2
        // =======================================================
        $('.js-select2-custom').each(function () {
          var select2 = $.HSCore.components.HSSelect2.init($(this));
        });
        function imageHandler() {
            const input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');
            input.click();
            input.onchange = async function() {
              const file = input.files[0];
              console.log('User trying to uplaod this:', file);
              await imageHandler1(file)
              .then(response => response.json())
              .then(result => {
            	  const range = this.quill.getSelection();
            	  const link = result.fileDownloadUri;
            	  this.quill.insertEmbed(range.index, 'image', link); 
                console.log('Success:', result);
              })
              .catch(error => {
                console.error('Error:', error);
              });
              //const id = await uploadFile(file); // I'm using react, so whatever upload function
              //const range = this.quill.getSelection();
              //const link = `${ROOT_URL}/file/${id}`;
				//const link = response.fileDownloadUri;
              // this part the image is inserted
              // by 'image' option below, you just have to put src(link) of img here. 
              //this.quill.insertEmbed(range.index, 'image', link); 
            }.bind(this); // react thing
          }
        async function imageHandler1(image) {
        	 // Default options are marked with *
        	  var data = new FormData();
        	  data.append('file', image);
        	  const response = await fetch("/uploadFile", {
        	    method: 'POST', // *GET, POST, PUT, DELETE, etc.
        	    body: data // body data type must match "Content-Type" header
        	  });
        	  return response; // parses JSON response into native JavaScript objects
        	}
        	
        	  

        
        // INITIALIZATION OF QUILLJS EDITOR
        // =======================================================
        	var toolbarOptions =  [
                [{ "font": [] }, { "size": ["small", false, "large", "huge"] }], // custom dropdown

                ["bold", "italic", "underline", "strike"],

                [{ "color": [] }, { "background": [] }],

                [{ "script": "sub" }, { "script": "super" }],
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

                ["blockquote", "code-block"],

                [{ "list": "ordered" }, { "list": "bullet" }, { "indent": "-1" }, { "indent": "+1" }],

                [{ "direction": "rtl" }, { "align": [] }],

                ["link", "image", "formula"],

                ["clean"]
            
					 
					  // remove formatting button
					];
        var quill = $.HSCore.components.HSQuill.init('.js-quill',{
        	  modules: {
        		    toolbar: {
        		    	container:toolbarOptions, 
        		    	handlers:{'image':imageHandler}}
        		  },
        		  theme: 'snow'
        		});
        
        	

        
        // INITIALIZATION OF ADD INPUT FILED
        // =======================================================
        $('.js-add-field').each(function () {
          new HSAddField($(this), {
            addedField: function() {
              $('.js-add-field .js-select2-custom-dynamic').each(function () {
                var select2dynamic = $.HSCore.components.HSSelect2.init($(this));
                
              });
            }
          }).init();
        });

        
        // INITIALIZATION OF TAGIFY
        // =======================================================
        $('.js-tagify').each(function () {
          var tagify = $.HSCore.components.HSTagify.init($(this));
        });

        var imageUrlArray = [];
        // INITIALIZATION OF DROPZONE FILE ATTACH MODULE
        // =======================================================
        $(".js-dropzone").each(function () {
            var dropzone = $.HSCore.components.HSDropzone.init(
              "#" + $(this).attr("id"),{
            	  url: "/uploadFileDisk",
                  uploadMultiple: true,
                  parallelUploads: 5,
                  maxFiles: 5,
                  acceptedFiles: "image/*",
                  success: function (file, response) {
              		if ($('#customSwitch1').is(":checked"))
      	          	  {
      	          		console.log(true);
      	          	  } else {
      	          		console.log(false);
      	          	  }
                		  imageUrlArray = JSON.parse(file.xhr.response);
                      }
              }
             
              

            );
            dropzone.on("removedfile", function(file) {
            	let fileNameDelete;
            	JSON.parse(file.xhr.response).map((value,index) => {
            		let name = value.fileName.split("__")[0];
            		if(file.name.includes(name)){
            			return fileNameDelete = value.fileName;
            		}
            	});
            	$.ajax({
                    url : `/deleteFile/${fileNameDelete}`, // gá»­i ajax Ä‘áº¿n file result.php
                    type : "get", // chá»�n phÆ°Æ¡ng thá»©c gá»­i lÃ  get
                    dateType:"text", // dá»¯ liá»‡u tráº£ vá»� dáº¡ng text
                    //data : { // Danh sÃ¡ch cÃ¡c thuá»™c tÃ­nh sáº½ gá»­i Ä‘i
                    //     number : $('#number').val()
                    //},
                    success : function (result){
                     // Shows all indexes, including deleted
                        imageUrlArray.find(function(value, index) {
                          // Delete element 5 on first iteration
                          if (value.fileName === fileNameDelete) {
                             imageUrlArray.splice (index, 1);
                          }
                        });
                        console.log(imageUrlArray);
                    }
                });
                
              });
            //dropzone.success("addedfile", function(file, response) {
            //	 console.log(file);
            //  });
            
            $("#identifier").on("submit",function(){
            	
	           	$("#hiddenArea").val(quill.root.innerHTML.trim());
	          	$('#imageUrl').val(JSON.stringify(imageUrlArray));
	          	console.log($('#status'))
	           	});
            $("#customSwitch1").on("input",function(){
            	if ( $("#customSwitch1").is(":checked"))
	          	  {
	          		$('#status').prop('checked', true);
	          	  } else {
	          		$('#status').prop('checked', false);
	          	  }
            
          	});
            
          });
      });
    </script>
<script>

</script>
</th:block>

</body>
</html>